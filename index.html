<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <canvas id="life" width="500px" height="500px"></canvas>

    <script>
        const m = document.getElementById('life').getContext('2d');
        // отрисовка
        const draw = (x, y, c, s) => {
            m.fillStyle = c;
            m.fillRect(x, y, s, s);
        };
        // параметры 'vx':0, 'vy':0, - скорость, остальное координаты

        const particles = [];

        const createParticle = (x, y, c) => {
            return {
                'x': x,
                'y': y,
                'vx': 0,
                'vy': 0,
                'color': c
            };
        };

        // функция для случайного положения каждой частицы с внутренней функцией для создания группы частиц
        const random = () => {
            return Math.random() * 400 + 50;
        };

        const create = (number, color) => {
            const group = [];
            for (let i = 0; i < number; i++) {
                const particle = createParticle(random(), random(), color);
                group.push(particle);
                particles.push(particle);
            }
            return group;
        };

        // правило для частиц (притяжение и отталкивание)
        rule = (particles1, particles2, g) => {
            for (let i = 0; i < particles1.length; i++) {
                // сила для двух измерений
                fx = 0;
                fy = 0;
                for (let j = 0; j < particles2.length; j++) {
                    //частица 0
                    a = particles1[i]
                    //частица 1
                    b = particles2[j]
                    // вычисляем расстояние между ними по законам пифагора
                    dx = a.x - b.x;
                    dy = a.y - b.y;
                    d = Math.sqrt(dx * dx + dy * dy);
                    // вычисляем силу отталкивания частиц и распределяем по двум измерениям из соображений локализации процесса можем ограничить силу до 80
                    let max = 80;
                    if (d > 0 && d < max) {
                        F = g * 1 / d;
                        fx += (F * dx);
                        fy += (F * dy);
                    }
                }
                //создаем ускорение (увеличиваем скорость частиц на величину приложенной силы и изменяем их положение в соответствии с новой скоростью)
                // мы можем добавить коэффициенты для замедления скорости slow
                let slow = 0.5;
                a.vx = (a.vx + fx) * slow;
                a.vy = (a.vy + fy) * slow;
                // Обновляем позиции Х и У в соответствии с Расчетной силой
                a.x += a.vx;
                a.y += a.vy;
                // проверка на выхождение частицы из экрана (Запрещаем выходить за предел поля а точнее ее ускорение поменяется и станет со знаком минус - частица сначала замедлится а затем ускорится в обратном направлении и в итоге вернется назад)
                if (a.x <= 0 || a.x >= 500) { a.vx *= -1 }
                if (a.y <= 0 || a.x >= 500) { a.vy *= -1 }
            }
        }

        // Частицы
        const yellow = create(200, 'yellow');
        const red = create(200, 'red');
        const green = create(200, 'green')

        // АНИМАЦИЯ
        const update = () => {
            // Правила притяжения и отталкивания для частиц комментарий для понимания аналогии и простоты управления
                                                    //красные притягиваются друг к другу
                                            // rule(red, red, -0.1);
                                            //     //желтые немного притягивают красных
                                            // rule(red, yellow, -0.01);
                                            //     //красные отталкивают желтых
                                            // rule(yellow, red, 0.01);
                                // // Одно из взаимодействий трех цветов
                                //     rule(red, red, -0.1);
                                //     rule(yellow, red, 0.15);
                                //     rule(green, red, 0.2);
                                //     rule(green, green, -0.7);
                                //     rule(red, green, -0.1);
                        // Попугай 3 цвета
                        rule(green, green, -0.32);
                        rule(green, red, -0.17);
                        rule(green, yellow, 0.34);
                        rule(red, red, -0.10);
                        rule(red, green, -0.34); 
                        rule(yellow, yellow, 0.15);
                        rule(yellow, green, -0.20);
            // отчищаем поле
            m.clearRect(0, 0, 500, 500);
            draw(0, 0, 'black', 500);
            // добавляем на поле новые координаты (отрисовываем) каждую частицу
            for (let i = 0; i < particles.length; i++) {
                draw(particles[i].x, particles[i].y, particles[i].color, 5);
            }
            requestAnimationFrame(update);
        };

        update();
    </script>
</body>

</html>